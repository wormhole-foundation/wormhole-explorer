import { evmRedeemedTransactionFoundMapper } from "../../../../src/infrastructure/mappers/evm/evmRedeemedTransactionFoundMapper";
import { HandleEvmTransactions } from "../../../../src/domain/actions";
import { describe, it, expect } from "@jest/globals";

const txHash = "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d";

let statsRepo = {
  count: () => {},
  measure: () => {},
  report: () => Promise.resolve(""),
};

const handler = new HandleEvmTransactions(
  {
    abis: [
      {
        abi: "deliver(bytes[] encodedVMs, bytes encodedDeliveryVAA, address relayerRefundAddress, bytes deliveryOverrides)",
        topic: "0xbccc00b713f54173962e7de6098f643d8ebf53d488d71f4b2a5171496d038f9e",
      },
      {
        abi: "fulfillOrder(bytes cctpMsg, bytes cctpSigs, bytes encodedVm, address swapProtocol, bytes swapData)",
        topic: "0xcc5626df3b699006387b64eca775dbdfecd5ae542e2d6ab22923082e1320dfcb",
      },
      {
        abi: "redeemWithFee(bytes cctpMsg,bytes cctpSigs,bytes encodedVm)",
        topic: "0x58200b4c34ae05ee816d710053fff3fb75af4395915d3d2a771b24aa10e3cc5d",
      },
    ],
    environment: "testnet",
    metricName: "process_vaa_ethereum_event",
    commitment: "latest",
    chainId: 2,
    chain: "ethereum",
    id: "poll-redeemed-transactions-ethereum",
  },
  evmRedeemedTransactionFoundMapper,
  async () => {},
  statsRepo
);

describe("evmRedeemedTransactionFoundMapper", () => {
  it("should be able to map log to evmRedeemedTransactionFoundMapper without vaaInformation", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        blockNumber: 0x11ec2bcn,
        chainId: 1,
        from: "0xfb070adcd21361a3946a0584dc84a7b89faa68e3",
        gas: "0x14485",
        gasPrice: "0xfc518561e",
        hash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        input:
          "0xc68785190000000000000000000000000000000000000000000000000000000000000001637651ef71f834be28b8fab1dce9c228c2fe1813831bbc3673cfd3abde6dbb3d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080420000",
        maxFeePerGas: "0x1610f75b9a",
        maxPriorityFeePerGas: "0x5f5e100",
        nonce: "0x1",
        r: "0xf5794b0970386d73b693b17f147fae0427db278e951e45465ac2c9835537e5a9",
        s: "0x6dccc8cfee216bc43a9d66525fa94905da234ad32d6cc3220845bef78f25dd42",
        status: "0x1",
        timestamp: 1702663079,
        to: "0x3ee18B2214AFF97000D974cf647E7C347E8fa585",
        transactionIndex: "0x6f",
        type: "0x2",
        v: "0x1",
        value: "0x5b09cd3e5e90000",
        environment: "testnet",
        chain: "ethereum",
        logs: [
          {
            address: "0x3ee18B2214AFF97000D974cf647E7C347E8fa585",
            topics: [
              "0xf02867db6908ee5f81fd178573ae9385837f0a0a72553f8c08306759b7e0c00a",
              "0x0000000000000000000000000000000000000000000000000000000000000017",
              "0x0000000000000000000000002703483b1a5a7c577e8680de9df8be03c6f30e3c",
              "0x000000000000000000000000000000000000000000000000000000000000250f",
            ],
            data: "0x",
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result).toBeUndefined;
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with vaaInformation from the log topics", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        blockNumber: 0x11ec2bcn,
        chainId: 1,
        from: "0xfb070adcd21361a3946a0584dc84a7b89faa68e3",
        gas: "0x14485",
        gasPrice: "0xfc518561e",
        hash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        input:
          "0xc68785190000000000000000000000000000000000000000000000000000000000000001637651ef71f834be28b8fab1dce9c228c2fe1813831bbc3673cfd3abde6dbb3d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080420000",
        maxFeePerGas: "0x1610f75b9a",
        maxPriorityFeePerGas: "0x5f5e100",
        nonce: "0x1",
        r: "0xf5794b0970386d73b693b17f147fae0427db278e951e45465ac2c9835537e5a9",
        s: "0x6dccc8cfee216bc43a9d66525fa94905da234ad32d6cc3220845bef78f25dd42",
        status: "0x1",
        timestamp: 1702663079,
        to: "0x3ee18b2214aFF97000d974Cf647e7C347e8fa585",
        transactionIndex: "0x6f",
        type: "0x2",
        v: "0x1",
        value: "0x5b09cd3e5e90000",
        environment: "testnet",
        chain: "ethereum",
        logs: [
          {
            address: "0x3ee18B2214AFF97000D974cf647E7C347E8fa585",
            topics: [
              "0xf02867db6908ee5f81fd178573ae9385837f0a0a72553f8c08306759a7e0f00e",
              "0x0000000000000000000000000000000000000000000000000000000000000017",
              "0x0000000000000000000000002703483b1a5a7c577e8680de9df8be03c6f30e3c",
              "0x000000000000000000000000000000000000000000000000000000000000250f",
            ],
            data: "0x",
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(1);
    expect(result?.txHash).toBe(txHash.substring(2)); // Remove 0x
    expect(result?.blockHeight).toBe(18793148n);
    expect(result?.attributes.blockNumber).toBe(18793148n);
    expect(result?.attributes.from).toBe("0xfb070adcd21361a3946a0584dc84a7b89faa68e3");
    expect(result?.attributes.to).toBe("0x3ee18b2214aFF97000d974Cf647e7C347e8fa585");
    expect(result?.attributes.methodsByAddress).toBe("MethodCompleteTransfer");
    expect(result?.attributes.emitterChain).toBe(23);
    expect(result?.attributes.emitterAddress).toBe(
      "0000000000000000000000002703483B1A5A7C577E8680DE9DF8BE03C6F30E3C"
    );
    expect(result?.attributes.sequence).toBe(9487);
  });

  it("should be remove all events because is not possible map protocol values in mapper", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        blockNumber: 0x11ec2bcn,
        chainId: 1,
        from: "0xfb070adcd21361a3946a0584dc84a7b89faa68e3",
        gas: "0x14485",
        gasPrice: "0xfc518561e",
        hash: "0x612a35f6739f70a81dfc34448c68e99dbcfe8dafaf241edbaa204cf0e236494d",
        input:
          "0xc68785190000000000000000000000000000000000000000000000000000000000000001637651ef71f834be28b8fab1dce9c228c2fe1813831bbc3673cfd3abde6dbb3d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080420000",
        maxFeePerGas: "0x1610f75b9a",
        maxPriorityFeePerGas: "0x5f5e100",
        nonce: "0x1",
        r: "0xf5794b0970386d73b693b17f147fae0427db278e951e45465ac2c9835537e5a9",
        s: "0x6dccc8cfee216bc43a9d66525fa94905da234ad32d6cc3220845bef78f25dd42",
        status: "0x1",
        timestamp: 1702663079,
        to: "0x3ee18B2214AFF97000D974cf646E7C347E8fa585",
        transactionIndex: "0x6f",
        type: "0x2",
        v: "0x1",
        value: "0x5b09cd3e5e90000",
        environment: "testnet",
        chain: "ethereum",
        logs: [
          {
            address: "0x3ee18B2214AFF97000D974cf646E7C347E8fa585",
            topics: [
              "0xf02867db6908ee5f81fd178573ae9385837f0a0a72553f8c08306759a7e0f00e",
              "0x0000000000000000000000000000000000000000000000000000000000000017",
              "0x0000000000000000000000002703483b1a5a7c577e8680de9df8be03c6f30e3c",
              "0x000000000000000000000000000000000000000000000000000000000000250f",
            ],
            data: "0x",
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result).toBeUndefined;
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with vaaInformation from the log data (e.g. manual NTT)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x3cc1804f1ffb64a8a62383e20a493fb6a4ca7cfbc17a21382787b228e4906ca0",
        blockNumber: 19957644n,
        chainId: 10003,
        from: "0xe6990c7e206d418d62b9e50c8e61f59dc360183b",
        gas: "0x4f60c",
        gasPrice: "0x5f5e1000",
        hash: "0xcc63ff6948718c386158d8f6a678199575a3707b9d5014de4a984b5897d987f4",
        input:
          "0xf953cec700000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000154010000000001000bfc8dc23fa1933433ae7fcbcb24c0a20672131bbcf46a3b4faeb07072757dec7ef2a1cd1453b7146fe8f73c181e0c91e944d362324c3c4e61271501caaf1ed40165e656f000000000271200000000000000000000000055aaf4d9399c472b252e7c0b49408b5bc7d7328e0000000000000016c89945ff10000000000000000000000000459b4d6df31c1c1f8b6fda0f8ad77e1eff832bcf000000000000000000000000cc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff00910000000000000000000000000000000000000000000000000000000000000019000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b004f994e54540800000000001e8480000000000000000000000000ce0bd78b496bc8ddd25c8a192771e4537f0794c8000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b27130000000000000000000000000000",
        maxFeePerGas: "0x608f3d00",
        maxPriorityFeePerGas: "0x59682f00",
        nonce: "0x9",
        v: "0x1",
        r: "0x3b3a98aee936de6490a73dcf7653e75619f5189c6ad589286dedabd368a0e71b",
        s: "0x61335d02972125552e7f0c85b3333bae262e9751532fd45654c0dc764015f658",
        status: "0x1",
        timestamp: 1702663079,
        to: "0x0E24D17D7467467b39Bf64A9DFf88776Bd6c74d7",
        transactionIndex: "0x6f",
        type: "0x1",
        value: "0x0",
        environment: "testnet",
        chain: "arbitrum-sepolia",
        logs: [
          {
            address: "0x0E24D17D7467467b39Bf64A9DFf88776Bd6c74d7",
            topics: ["0xf6fc529540981400dc64edf649eb5e2e0eb5812a27f8c81bac2c1d317e71a5f0"],
            data: "0xd6e26148b9040a4a017db65958f5c5d30e6b53cf53a34299d8efa45c42cd2c8e000000000000000000000000000000000000000000000000000000000000271200000000000000000000000055aaf4d9399c472b252e7c0b49408b5bc7d7328e0000000000000000000000000000000000000000000000000000000000000016",
          },
          {
            address: "0xcc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff",
            topics: ["0x35a2101eaac94b493e0dfca061f9a7f087913fde8678e7cde0aca9897edba0e5"],
            data: "0x18f7512db4006dc0d2ee49923afaa07dbf530d7feda528969e7253236aa3c66d00000000000000000000000000ac6efc189140b50a043b5e43c108cf571586d10000000000000000000000000000000000000000000000000000000000000000",
          },
          {
            address: "0xcc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff",
            topics: [
              "0x504e6efe18ab9eed10dc6501a417f5b12a2f7f2b1593aed9b89f9bce3cf29a91",
              "0x18f7512db4006dc0d2ee49923afaa07dbf530d7feda528969e7253236aa3c66d",
            ],
            data: "0x",
          },
          {
            address: "0xb12c77938c09d81f1e9797d48501b5c4e338b45b",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b",
            ],
            data: "0x00000000000000000000000000000000000000000000000000470de4df820000",
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(10003);
    expect(result?.txHash).toBe("cc63ff6948718c386158d8f6a678199575a3707b9d5014de4a984b5897d987f4");
    expect(result?.attributes.methodsByAddress).toBe("WormholeTransceiverReceiveMessage");
    expect(result?.attributes.emitterChain).toBe(10002);
    expect(result?.attributes.emitterAddress).toBe(
      "00000000000000000000000055AAF4D9399C472B252E7C0B49408B5BC7D7328E"
    );
    expect(result?.attributes.sequence).toBe(22);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with vaaInformation from the log data (e.g. relayed NTT)", async () => {
    // When
    const [result] = await handler.handle([
      {
        hash: "0xd8ff00d9dc3d9a0fa3d8a1b66ca4a6ff8a39ca940ec13609e66ae6959660765c",
        transactionIndex: "0x1",
        blockHash: "0xcfb3d3bd9ee0f4df69acebc6bc7edffc679452a29459f8bea618da41a2f0e6e3",
        blockNumber: 19955591n,
        from: "0x734d539a7efee15714a2755caa4280e12ef3d7e4",
        to: "0x7b1bd7a6b4e61c2a123ac6bc2cbfc614437d0470",
        logs: [
          {
            address: "0x0E24D17D7467467b39Bf64A9DFf88776Bd6c74d7",
            topics: ["0xf557dbbb087662f52c815f6c7ee350628a37a51eae9608ff840d996b65f87475"],
            data: "0xe9d6f4dbc1d568640ce3f6111b2d082e8282461feb9812135b30c9f7c1dcf300000000000000000000000000000000000000000000000000000000000000271200000000000000000000000055aaf4d9399c472b252e7c0b49408b5bc7d7328e",
          },
          {
            address: "0xcc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff",
            topics: ["0x35a2101eaac94b493e0dfca061f9a7f087913fde8678e7cde0aca9897edba0e5"],
            data: "0xb20b3f32244182844595b9670c53aa82303829fe827af22c460458be9bbae85700000000000000000000000000ac6efc189140b50a043b5e43c108cf571586d10000000000000000000000000000000000000000000000000000000000000000",
          },
          {
            address: "0xcc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff",
            topics: [
              "0x504e6efe18ab9eed10dc6501a417f5b12a2f7f2b1593aed9b89f9bce3cf29a91",
              "0xb20b3f32244182844595b9670c53aa82303829fe827af22c460458be9bbae857",
            ],
            data: "0x",
          },
          {
            address: "0xb12c77938c09d81f1e9797d48501b5c4e338b45b",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b",
            ],
            data: "0x00000000000000000000000000000000000000000000000000354a6ba7a18000",
          },
          {
            address: "0x7b1bd7a6b4e61c2a123ac6bc2cbfc614437d0470",
            topics: [
              "0xbccc00b713f54173962e7de6098f643d8ebf53d488d71f4b2a5171496d038f9e",
              "0x00000000000000000000000000ac6efc189140b50a043b5e43c108cf571586d1",
              "0x0000000000000000000000000000000000000000000000000000000000002712",
              "0x00000000000000000000000000000000000000000000000000000000000013ac",
            ],
            data: "0xe9d6f4dbc1d568640ce3f6111b2d082e8282461feb9812135b30c9f7c1dcf3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002dd05000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
          },
        ],
        status: "0x1",
        type: "0x2",
        nonce: "0x162",
        value: "0x21d5dab38e83e0",
        gasPrice: "0x5f8ee40",
        gas: "0x3d0900",
        input:
          "0xa60eb4c8000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000734d539a7efee15714a2755caa4280e12ef3d7e40000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a2010000000001000648a2069233ff8ef1a7a07d62ede39bfef7b50cd5d40dfc9c295d42c66f0f096a5c358ad589646b1d61e95f56602ab771c4b6bdcae49890a40d32171b58549d0165e6518c0000000027120000000000000000000000007b1bd7a6b4e61c2a123ac6bc2cbfc614437d047000000000000013ac0f01271300000000000000000000000000ac6efc189140b50a043b5e43c108cf571586d1000000d99945ff10000000000000000000000000459b4d6df31c1c1f8b6fda0f8ad77e1eff832bcf000000000000000000000000cc1ebd7a6661c0f6e19d2bbdb881b11f3b3f40ff00910000000000000000000000000000000000000000000000000000000000000018000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b004f994e545408000000000016e360000000000000000000000000ce0bd78b496bc8ddd25c8a192771e4537f0794c8000000000000000000000000e6990c7e206d418d62b9e50c8e61f59dc360183b2713000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a120000000000000000000000000000000000000000000000000000000046f5399e7271300000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a0a53847776f7e94cc35742971acb2217b0db810000000000000000000000007a0a53847776f7e94cc35742971acb2217b0db8100000000000000000000000055aaf4d9399c472b252e7c0b49408b5bc7d7328e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        v: "0x0",
        r: "0xf30b39c8ded6f12c89bc84447fabc57efa33ce14301be27bcc8daba7d1554619",
        s: "0x24f3411550177e821f2f87ef7a07d50b15f04c51b5c977ef207e2639a9296a90",
        maxPriorityFeePerGas: "0x30d40",
        maxFeePerGas: "0x6553f100",
        chainId: 421614,
        timestamp: Date.now(),
        environment: "testnet",
        chain: "arbitrum-sepolia",
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(421614);
    expect(result?.txHash).toBe("d8ff00d9dc3d9a0fa3d8a1b66ca4a6ff8a39ca940ec13609e66ae6959660765c");
    expect(result?.attributes.methodsByAddress).toBe("StandardRelayerDelivery");
    expect(result?.attributes.emitterChain).toBe(10002);
    expect(result?.attributes.emitterAddress).toBe(
      "0000000000000000000000007B1BD7A6B4E61C2A123AC6BC2CBFC614437D0470"
    );
    expect(result?.attributes.sequence).toBe(5036);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with vaaInformation from the log topics (e.g. PORTAL TOKEN BRIDGE)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0xfe78ab4e96e70b70fa773283ada9e582a5506372757d570e8ac624ea7d23f602",
        blockNumber: 0x5584a3n,
        from: "0x6d225d88426737dbd56bbb959954cb787b5b63fe",
        gas: "0x2a0f1",
        gasPrice: "0x3b9acaed",
        maxPriorityFeePerGas: "0x3b9ac9ee",
        maxFeePerGas: "0x3b9acb26",
        hash: "0x350f1c1cd25ad3dffe6457ebec8432b861dd7e7884567ca3008ff28ab442cef7",
        input:
          "0xc687851900000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000100010000000001006578c0722c90b0bc493e6b743faf528a2a6a88ddf2604f913e36d92863953b7f742d639f3f96341a7e98ce08f9cc63a8aaa8cbd2f923153f8888a1645577276600660a5b17000103e200013b26409f8aaded3f5ddca184695aa6a0fa829b0c85caf84856324896d214ca980000000000006dc9200100000000000000000000000000000000000000000000000000000004b2cb597dd1507814aad5e65844574a570d123fe7d6eefadce5907471023f9e69d48a064e00010000000000000000000000006d225d88426737dbd56bbb959954cb787b5b63fe27120000000000000000000000000000000000000000000000000000000000000000",
        nonce: "0x12",
        to: "0xdb5492265f6038831e89f495670ff909ade94bd9",
        transactionIndex: "0x4d",
        value: "0x0",
        type: "0x2",
        chainId: 10002,
        v: "0x1",
        r: "0x6135b27ac924f0496534e12ecc904b3f26b2149505930bb9375be59c5de31b01",
        s: "0x2fa69d91ce7d738639b57e8ee7c2de77fc4dcb1921e66ddce811bcb9d1811fa8",
        status: "0x1",
        timestamp: 1711954956,
        environment: "testnet",
        chain: "ethereum-sepolia",
        logs: [
          {
            address: "0x6a90bff9a9fee43c3ed12869e0cfe4f6c8e000e7",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x0000000000000000000000006d225d88426737dbd56bbb959954cb787b5b63fe",
            ],
            data: "0x00000000000000000000000000000000000000000000000000000004b2cb597d",
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(10002);
    expect(result?.txHash).toBe("350f1c1cd25ad3dffe6457ebec8432b861dd7e7884567ca3008ff28ab442cef7"); // Remove 0x
    expect(result?.blockHeight).toBe(5604515n);
    expect(result?.attributes.blockNumber).toBe(5604515n);
    expect(result?.attributes.from).toBe("0x6d225d88426737dbd56bbb959954cb787b5b63fe");
    expect(result?.attributes.to).toBe("0xdb5492265f6038831e89f495670ff909ade94bd9");
    expect(result?.attributes.methodsByAddress).toBe("MethodCompleteTransfer");
    expect(result?.attributes.emitterChain).toBe(1);
    expect(result?.attributes.emitterAddress).toBe(
      "3b26409f8aaded3f5ddca184695aa6a0fa829b0c85caf84856324896d214ca98"
    );
    expect(result?.attributes.sequence).toBe(28105);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with vaaInformation from the log topics (e.g NTT for W token)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x2ed1e4699d1db88d7967a06a30e87783bfa2cd4cd3b6d452c4cbe8c125a021a6",
        blockNumber: 0xcc12d6n,
        from: "0x44a56b20e2f60f89a5711b819db4d866574bf010",
        gas: "0x659ef",
        gasPrice: "0x3747d0e",
        maxFeePerGas: "0xc09acfd8",
        maxPriorityFeePerGas: "0x30d40",
        hash: "0xf3e0110825f056831129d6b07430fd87c491999ee033617ebf5ee8d3da1fffd4",
        input:
          "0xf953cec70000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000046c01000000040d00289fec07a6f7232c5252cd54f0700939945a2c7990b26772dfdfb9b6658048ec53daeceb79fd6f8391ed69ed9ddecf55be0c52b4e425161627e73f06f35f94400101e1d2bd4e217e8d7adb4ca65f397f91ad8cedc3b4d7b81aaca4dcca97866072f45bb9f982d4fb5c54c5c714b213a75b76de79557f95dcef00b01d7d935e837b3e00049040420290c5ee47a29846661086e890dd8f191c7faf8c3085219f7e572b9edd003975d584b3e23654354e27b3a09bf18043298601afb9b588556daf25a363da0006dd6640d85edcb0330e1cc320c3528c0f5caa07f0f65f995874ccdad357a1c18343f59b8ab5f3efaf68cd30863c0b82b6b1d882c3a25d8c2d1be63635c8de89080007042035c81916e803ebe2d5acc02e3dabacbb34f407b90f31a075a9a34f06b063227d35e3c683164b900bcc9fc590c4d3e515dbb365c946ee251289b022a8ed1a00089b3e2c3bbaf46318d38fe0c501bdb325b4b605c00a2ace9b70f27077b221274d53874211dfa14a2a3987c260a5653b5ada9bb8df2f6320f310422d0c837c5f55000a7f57084cb5d1dde75c152403f88b3b864cc4f1b3efd7de819de90034e59204e62c6cfd2664b4ad0600f5085abb79c317081ddd83b530058ca91a49f611a1ebf4010b5c1dc054fbb5c11ed8df2aa5ba401692a0c10a861450a44d3c7a3bad84251031078f978b0f7ff9fa358564872b8d1259363edd7a93d9d790edab75e193bd5954000dac4b5201aee6055b49cf67e94414f01c75175fd7e3a8c236c5c432eee9e87c810764ec5aee22d6e4ac9e18d9969f0c1d11c9c09f60187b086082af38617725e7010f60850ce65a990fd64e26eecc7523d1e3fb5962b72bc7ce69058ed0b8429416050babfdae411cfe7eab7c76cf100b85d295f824ed40c40624dad7fc0cd1f5bf0300102bbde4c23983ed1dc30c832bc86a71d4a286f2769c3cd2edb40b7e647255c1b52b66c1aee289b9c1d15ace4db2e42037fd3fd67d48a76337bf73c4dca4a182ab011102ef207e5fd895b82e78339e5d810b279d6cb5196f87921c79732f6ac23f33b5528b2449f8d740fb10cc1c0b555cc4950e1f4e070098a2f8518f06122a4020f40012aa6bb3a3722c8ed10aedf00cc6aaa1d006f156c0882fc9ecb071d9d1ef70b66050755b634b8d86f8505ff2eab0dd0466548d189848cdfb15b5928a34d73c58420166228271000000000001cf5f3614e2cd9b374558f35c7618b25f0d306d5e749b7d29cc030a1a15686238000000000000001c209945ff10057f97be1c39478e57974f6cc9dbfbeebb0e5ce340c2efd52b8295e889a9ede40000000000000000000000005333d0aca64a450add6fef76d6d1375f726cb4840091f6584bf5ce12459598bbaf47ec38d42deec0d8234c826ea6940eb0e87038985767947ef13a158cb9bfcabea018b3f8d2e55b2281a76362624273971dbafa1e99004f994e54540600000000000027106927fdc01ea906f96d7137874cdd7adad00ca35764619310e54196c781d84d5b00000000000000000000000049887a216375fded17dc1aaad4920c3777265614001e00000000000000000000000000000000000000000000",
        nonce: "0x2",
        to: "0xd1a8ab69e00266e8b791a15bc47514153a5045a6",
        transactionIndex: "0x26",
        value: "0x0",
        type: "0x2",
        chainId: 30,
        v: "0x0",
        r: "0x6b4fbf9838f9a9bfe175b30245221558a9935b7c817959e780d1b6a673e2fdc7",
        s: "0x4f9c5abeb848486244df757ba16c2d2436225b2bf2c8adff56d4ecedb51b15b3",
        status: "0x1",
        timestamp: 1713537679,
        environment: "mainnet",
        chain: "base",
        logs: [
          {
            address: "0xd1a8ab69e00266e8b791a15bc47514153a5045a6",
            data: "0xf41341582ab18d4be58d1f914ac65a8e5b6932a41db1aad46a0bf141051065ec0000000000000000000000000000000000000000000000000000000000000001cf5f3614e2cd9b374558f35c7618b25f0d306d5e749b7d29cc030a1a15686238000000000000000000000000000000000000000000000000000000000000001c",
            topics: ["0xf6fc529540981400dc64edf649eb5e2e0eb5812a27f8c81bac2c1d317e71a5f0"],
          },
          {
            address: "0x5333d0aca64a450add6fef76d6d1375f726cb484",
            data: "0x1f715f6fc356db0fd7dfefec21c8023e06026036b304a7315e10b91dafc49990000000000000000000000000d1a8ab69e00266e8b791a15bc47514153a5045a60000000000000000000000000000000000000000000000000000000000000000",
            topics: ["0x35a2101eaac94b493e0dfca061f9a7f087913fde8678e7cde0aca9897edba0e5"],
          },
          {
            address: "0x5333d0aca64a450add6fef76d6d1375f726cb484",
            data: "0x",
            topics: [
              "0x504e6efe18ab9eed10dc6501a417f5b12a2f7f2b1593aed9b89f9bce3cf29a91",
              "0x1f715f6fc356db0fd7dfefec21c8023e06026036b304a7315e10b91dafc49990",
            ],
          },
          {
            address: "0xb0ffa8000886e57f86dd5264b9582b2ad87b2b91",
            data: "0x000000000000000000000000000000000000000000000000002386f26fc10000",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x00000000000000000000000049887a216375fded17dc1aaad4920c3777265614",
            ],
          },
          {
            address: "0xb0ffa8000886e57f86dd5264b9582b2ad87b2b91",
            data: "0x0000000000000000000000000000000000000000000000000031bced02db0000000000000000000000000000000000000000000000000000005543df729c0000",
            topics: [
              "0xdec2bacdd2f05b59de34da9b523dff8be42e5e38e818c82fdb0bae774387a724",
              "0x00000000000000000000000049887a216375fded17dc1aaad4920c3777265614",
            ],
          },
        ],
        gasUsed: "0x6efa0",
        effectiveGasPrice: "0x2fb1471cd",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(30);
    expect(result?.txHash).toBe("f3e0110825f056831129d6b07430fd87c491999ee033617ebf5ee8d3da1fffd4"); // Remove 0x
    expect(result?.blockHeight).toBe(13374166n);
    expect(result?.attributes.blockNumber).toBe(13374166n);
    expect(result?.attributes.from).toBe("0x44a56b20e2f60f89a5711b819db4d866574bf010");
    expect(result?.attributes.to).toBe("0xd1a8ab69e00266e8b791a15bc47514153a5045a6");
    expect(result?.attributes.methodsByAddress).toBe("WormholeTransceiverReceiveMessage");
    expect(result?.attributes.emitterChain).toBe(1);
    expect(result?.attributes.emitterAddress).toBe(
      "CF5F3614E2CD9B374558F35C7618B25F0D306D5E749B7D29CC030A1A15686238"
    );
    expect(result?.attributes.sequence).toBe(28);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper from the abi (e.g MAYAN WITH SWIFT)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0xc06ab5fdd29b2d1f7d89e30c457b4f0b480450ed4f7245da02555dfc58b37384",
        blockNumber: 0xf0cebdan,
        from: "0x5acf4e865604ab620fb84acc047b990f2d2856fd",
        gas: "0x4c4b400",
        gasPrice: "0x5a00c580",
        maxFeePerGas: "0x5a995c00",
        maxPriorityFeePerGas: "0x59682f00",
        hash: "0x39c22c63e2423c0f585155a618911b08d602c5e362662aa3c4455ee272021a4f",
        input:
          "0x078eab7200000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000280000000000000000000000000111111125421ca6dc452d289314280a0f8842a65000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000f800000000000000060000000300000000000449170000000000000000000000001682ae6375c4e4a97e4b583bc394c861a46d896200000000000000000000000019330d10d9cc8751218eaf51e8885d058642e08a000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c00000000000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000007b41fb5c000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c00000000000000000000000000000000000000000000000000000000000000000000000000000082fe610d3aeafb646902e37c4b6c2787e6b85c78ba7b799d8244998d7d743e9f3c1d51225eaa356a8be9deb3dd2af32bd7543af47f503b63b1b7b412f46ce4af611b283910ab5d5c7e282a83b1d698024070b218696d4ea21a9f02240a512cece88575d58dfeb4b7dce6fa58144d935a30768aeedbfd0a79ee946510cc5bea5add611c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044501000000040d00124bc1f8c7dae9899d0350145562be3ab2b3c51245edf83bac110351108cb0d970f3b1386b841c1b283867c0566edcc2161238c8f516c60ea394b4127a598eba00021ad7054b53672ec9e146b41bdc657cd9aca78156982d1d8b0dfc696909bf424755694d4755def7eaf85704f17bf30b1a75df48d26ba26a0440a6390c27a4c00d00041f3f172a6e3cdce6f8839f57e1ce8462e97f13692d8d5206539e6d2dc70350592fc433c712b9118c8e7809299c9b2e852062dc35aec58aefbd7f4de01e741b520006330bfd9cc70bcfe93a72afa3facdf0076c2e78c8d182614f78e538d76b74a0bf56108331b269f6dcc757a448f0b156fd7e06b11bf32123d7e2ce7383032b25db0107bd17819c5ecf8d9be86f766d79828abd238f737645686e8f6ae76a786b67a88650acfbf36275f56fa0c0e9fd179abb0fa11cd55ff57d8bb5ddfde84d701f86d80108947a8526882f8f457643037983d2891c2d47b19a0b3e948351c9ba316630a21e394ebb44e9a7ae4dabd1a42076077f86f7fc5a447e86bac6a6df033b283ecda20109bd30ecf09adff56756c41f8157a49ba6125de3dbe63fa4c8e2522599c1d09ed018d51da123ab6301c33a8c70922c380eb5ab3764cce8fce53b23a87bef9712f1000d2c439e20ac78b1dcbc84e5ca00dfda33f4b8384f1b0bacc2add2a65ed2ae35fe44756d86a15104efd4dd7d612e845ad2660b8e2d7307737ca63b239abcade9c9010e9bb5d6aa8d9ff203195100952c6882dc8e8da411a4d39a0bbac8be72c429e07f39b8eb6c490fdbd94021df62dcdfa1b6e336df7c49aa8cfff6556742087b7eda010f10c33adb0eee8acadaa6efcd946d86b72bc1feb78bc86a392e77f39fe888f0f876b39aa6ed6179157c19207502e00c4318603fe52ba2174001363c4650bc5e1100100387591a471959cb7b6e8c5be540bb99a3ce88698769572e4ab65722acf4c50b369f6e3bc35788f235c1b06547cbbcc0bc959087d5dfb10b8fe6b5dae2851171011179549da621a86a084d30caed67713befa0d825f69fb56d7d3303284d96e7fde857b37f33618eb343b793b786b59d274eaeef69a770a8cce6876e9046e27595b90112c1103d9b118936b288213771751a1eb3642f70771f753ab24c276bae4756918e3a54c4976d0b72f6211ba403db77bcb2cd46f459fbeb2f6c496974e98c814dfb0066e1f4f9000000010001320a277b216ad7630fcdeec95878d2261ef01b423d48cea81ea808d7984a224600000000000038b720020100170000000000000000000000009ff21192f8a7bd002328e9d17ad77de4f57d99f70000000000000000000000005acf4e865604ab620fb84acc047b990f2d2856fd000000000000000000000000fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb90000000079eacc480000000000000000000000000000000000000000a5aa6e2171b416e1d27ec53ca8c13db3f91a89cd00000000000066e2071800000000001a2238000000060000000000044917000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028807ed2379000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831000000000000000000000000fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000007b27d924000000000000000000000000000000000000000000000000000000003d92fe580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001370000000000000000000000000000000000000000000001190000eb0000a100a007e5c0d200000000000000000000000000000000000000000000000000007d00004f02a0000000000000000000000000000000000000000000000000000000003d938f03ee63c1e501c86eb7b85807020b4548ee05b54bfc956eebbfcdaf88d065e77c8cc2239327c5edb3a432268e583100a0a87a1ae8e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fbff970a61a04b1ca14834a43f5de4533ebddb5cc800a0f2fa6b66fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9000000000000000000000000000000000000000000000000000000007b25fcb1000000000000000000000000004c62e980a06c4eca27fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9111111125421ca6dc452d289314280a0f8842a650000000000000000001ea79a4f000000000000000000000000000000000000000000000000",
        nonce: "0xf8f0",
        to: "0xf18f923480dc144326e6c65d4f3d47aa459bb41c",
        transactionIndex: "0x1",
        value: "0x0",
        type: "0x2",
        chainId: 23,
        v: "0x0",
        r: "0x573d5fb07bd2ea02983a813e6d12232166ef2464f36b848bf349596e923b9ca2",
        s: "0x2bbdd80b5f8592039db306ae111b2164b23f0faf2bfd5b62afaa53328bfea7ef",
        effectiveGasPrice: "0x989680",
        gasUsed: "0x11221e",
        timestamp: 1726084363,
        status: "0x1",
        logs: [
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xab8530f87dc9b59234c4623bf917212bb2536d647574c8e7e5da92c2ede0c9f8",
              "0x000000000000000000000000e7ed1fa7f45d05c508232aa32649d89b73b8ba48",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b41fb5c",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b41fb5c",
          },
          {
            address: "0x19330d10d9cc8751218eaf51e8885d058642e08a",
            topics: [
              "0x1b2a7ff080b8cb6ff436ce0372e399692bbfb6d4ae5766fd8d58a7b8cc6142e6",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b41fb5c",
          },
          {
            address: "0xc30362313fbba5cf9163f0bb16a0e01f01a896ca",
            topics: [
              "0x58200b4c34ae05ee816d710053fff3fb75af4395915d3d2a771b24aa10e3cc5d",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x0000000000000000000000000000000000000000000000000000000000044917",
            ],
            data: "0x00000000000000000000000000000000000000000000000000000000000000060000000000000000000000001682ae6375c4e4a97e4b583bc394c861a46d89620000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008400000000000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000007b41fb5c000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c00000000000000000000000000000000000000000000000000000000",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x0000000000000000000000005acf4e865604ab620fb84acc047b990f2d2856fd",
            ],
            data: "0x00000000000000000000000000000000000000000000000000000000001a2238",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b27d924",
          },
          {
            address: "0xc86eb7b85807020b4548ee05b54bfc956eebbfcd",
            topics: ["0x8a89de70856bccec096661388f305b9a75f5f65cb0d8a0e1e803c39dabedb57f"],
            data: "0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001",
          },
          {
            address: "0xff970a61a04b1ca14834a43f5de4533ebddb5cc8",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000c86eb7b85807020b4548ee05b54bfc956eebbfcd",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b271e06",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000c86eb7b85807020b4548ee05b54bfc956eebbfcd",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b27d924",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000c86eb7b85807020b4548ee05b54bfc956eebbfcd",
              "0x00000000000000000000000058095979b412a366687ca05cbe85ff56241be21f",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000000000136",
          },
          {
            address: "0xc86eb7b85807020b4548ee05b54bfc956eebbfcd",
            topics: [
              "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b27d924ffffffffffffffffffffffffffffffffffffffffffffffffffffffff84d8e1fa0000000000000000000000000000000000000000ffff449c3761ff011e3ba6ce000000000000000000000000000000000000000000000000002f3c704f243499ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
          },
          {
            address: "0xff970a61a04b1ca14834a43f5de4533ebddb5cc8",
            topics: [
              "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b271e06",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b25fcb1",
          },
          {
            address: "0xff970a61a04b1ca14834a43f5de4533ebddb5cc8",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b271e04",
          },
          {
            address: "0xff970a61a04b1ca14834a43f5de4533ebddb5cc8",
            topics: [
              "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000000000002",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000e4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
              "0x00000000000000000000000001d3e7271c278aa3aa56eeba6a109b2c200679fa",
            ],
            data: "0x00000000000000000000000000000000000000000000000000000000000050b4",
          },
          {
            address: "0xe4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            topics: [
              "0xe4fed5362e2669c70e5da5a18942d1e617d8917f6adc0164d9668bd3a6d0cebe",
              "0x00000000000000000000000001d3e7271c278aa3aa56eeba6a109b2c200679fa",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000050b4",
          },
          {
            address: "0xe4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            topics: ["0xa259c93818139b6bc90fb80e8feb75122b42edaae49560f81392cf4e1946726e"],
            data: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
          },
          {
            address: "0xe4b2dfc82977dd2dce7e8d37895a6a8f50cbb4fb",
            topics: [
              "0xe93ad76094f247c0dafc1c61adc2187de1ac2738f7a3b49cb20b2263420251a3",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b25fcb1000000000000000000000000000000000000000000000000000000007b271e04",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd09",
              "0x000000000000000000000000111111125421ca6dc452d289314280a0f8842a65",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b25fcb1",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000111111125421ca6dc452d289314280a0f8842a65",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b25fcb1",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x0000000000000000000000009ff21192f8a7bd002328e9d17ad77de4f57d99f7",
            ],
            data: "0x000000000000000000000000000000000000000000000000000000007b25fcb1",
          },
          {
            address: "0xf18f923480dc144326e6c65d4f3d47aa459bb41c",
            topics: ["0xcc5626df3b699006387b64eca775dbdfecd5ae542e2d6ab22923082e1320dfcb"],
            data: "0x00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000044917000000000000000000000000000000000000000000000000000000007b25fcb1",
          },
        ],
        environment: "mainnet",
        chain: "arbitrum",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(23);
    expect(result?.txHash).toBe("39c22c63e2423c0f585155a618911b08d602c5e362662aa3c4455ee272021a4f"); // Remove 0x
    expect(result?.blockHeight).toBe(252505050n);
    expect(result?.attributes.blockNumber).toBe(252505050n);
    expect(result?.attributes.from).toBe("0x5acf4e865604ab620fb84acc047b990f2d2856fd");
    expect(result?.attributes.to).toBe("0xf18f923480dc144326e6c65d4f3d47aa459bb41c");
    expect(result?.attributes.methodsByAddress).toBe("MethodFulfillOrder");
    expect(result?.attributes.emitterChain).toBe(1);
    expect(result?.attributes.emitterAddress).toBe(
      "320a277b216ad7630fcdeec95878d2261ef01b423d48cea81ea808d7984a2246"
    );
    expect(result?.attributes.sequence).toBe(14519);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper with redelivery information (e.g FAST TRANSFER)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x1704df1c5afafdea42fa8f9f03339745ac168d4cabd0b3222a5671e500b772af",
        blockNumber: 0xeb97ef1n,
        from: "0x832232edc32349e240b488f2be0ce80e6c0befa8",
        gas: "0xb5d20",
        gasPrice: "0x5a00c580",
        maxFeePerGas: "0x5a995c00",
        maxPriorityFeePerGas: "0x59682f00",
        hash: "0x64186f62f05347fc1d54618b10f2fbe1c2c7ddee3fcf37de8ff9dcf81914ec08",
        input:
          "0x604009a900000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000560000000000000000000000000000000000000000000000000000000000000068000000000000000000000000000000000000000000000000000000000000004c801000000040d00974cfea0672763f8b94af1f4e23628a31b7623ab413c39cb92e8fecf6730f251195afa9fd32f17a0436b80eb95d9dcc4054a93681575963827ce2b819df852a40101f98f42a7f413bea634276c56db901c1fde667cabbe8b8e9c2dcaf4b560aace010771d54d3b6baf8dbd078505839437f1988c7f9bfc2625dbe1d01f5cb1629d270002dc8299b455ab8d9a1d43d59e5117ca69d7f690af24820a31f7f9719f55afffd446db20b5a2b13bbcae7d8f26eccacfe7a2d260923fc08db57a157e532026d1900104dafdcb10b23aa775bed3bddeba4a8c5bd0b910e8cf73a174127885945feea6ab0a93832cb1535915f49bfd82fc48dd04da3b08551a81eac31ddaf1fc939e5780010602e2c3328fa136d35666dd729ab73750a407c779a60437b6b2d10704dab9430c25683b4e41cd1b7ca385d387bf1f08f2f4c01830e61f07ef1723c4125f88a7c20108d00c35d3424637e0f5652fc73369a3226e282c65763f0cb4df2f12beb3ce7efd45a221cedb80bf211ec9e8e408a362da0c947e4356b550dca4288dbf56c8d3c6010911bfbdf67a4781b77adfd5d7f81c24173fd4a480aa8d71ad38e08c6b1979e5792574e18636201767e696a819eebc448a35afffc8d4fa9dc6743e9a8ad1db7474000a3fee0c3c0491bd924db91b2311d3153a27274276e88fab27d26a1aeafdb9540d21315c3b8d154babaf295ce1b98ca6040b66a087d3933044712282eee8480bce010b1559545321a359c06910b53438e206e11e1aeb6e650a598430cbd2a954f44d075c852bf48135db8822b97a81a03556860b76531442bb5dd098661c041944cd3f010d3bbb91a9e56d06678692f63a18a2b9fe3d9325c5927fd88c633ac7189951611139e3998f8c4bb90984593112aba4448932e0abf3fd46e6f4142fdf70d2eaea16010e9637ee4a235a37aa8e76b9b661e9aba0559486bf82e0f7684532cdfa7429ae345bb797302ac1343d082f75942eb68b63da092b59f96c93905f224a3c45bf49ac00104a9a68e7a1f2a3f8a4ad8fed61bac0099dc369e24795d26c919429da55b906d961da921ae10e4995f607fe5d5d4d4cddb2eb7c8ab05af16e0733560d1bda98ad0011ad100746284b64d0bdafb589f48341cdcb688f56879bb5cc5fd6d11664219f207585fa70759a3c687bf6d4aec241008673dc819c11c03a940fb058cb030186490166ccf65000000000000174e70ed52464f997369bbefd141d8a2d9dd3cd15e1f21b37bce18f45e0e923b200000000000000052001c6fa7af3bedbad3a3d65f36aabc97431b1bbe4c2d2f6e0e47ca60203452f5d610000000000000000000000000000000000000000000000000000000005efc77f000000050000000300000000000109079ed22d6320c1335e6d2c1a29898d86fdcd00c2f239e71ea25edd123253a6e3dd00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c4700a201001e0000000000000000000000002ab7beef955826054d03419ee2122445ca677eb20000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43005d01000000000000000000000000933e3922e04d47a466e60a20e486b372b64f1ea80200000bb80000000637cc0166ce356a0000000000000000000110d9316ec0000100006401fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb90001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f80000000000000005000000030000000000010907a65fc943419a5ad590042fd67c9791fd015acf53a54cc823edb8ff81b9ed722e00000000000000000000000019330d10d9cc8751218eaf51e8885d058642e08a00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c4700000000c6fa7af3bedbad3a3d65f36aabc97431b1bbe4c2d2f6e0e47ca60203452f5d6100000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c470000000000000000000000000000000000000000000000000000000005efc77f74e70ed52464f997369bbefd141d8a2d9dd3cd15e1f21b37bce18f45e0e923b200000000000000000000000000000000000000000000000000000000000000000000000000000082df1a5fe8e1a792c74a0ee6a3d3a461a0e63c1c5c6068efd60a659e6d6d655af738b2976a1e4328e019d763f380493483b81772e69c9bad29c0525ca922cbd2fa1be62f6f0a17aa90b3a9675d96ef1480db815d7db8e64d45ecd7d5add6fe595d1d3a70055d3b3744d909b824203b942f708eae0e0739385e3caac0435b1e08f0c51c000000000000000000000000000000000000000000000000000000000000",
        nonce: "0x2",
        to: "0x4de319b7492e791cde47fdf12c922cf568441c43",
        transactionIndex: "0x2",
        value: "0xaa87bee538000",
        type: "0x2",
        chainId: 23,
        v: "0x1",
        r: "0xc743c9881466a9a3e1bfdffcef0111dfae90840e269d820a1226bb1d9b47d274",
        s: "0x4c7f16f95424fed38a43b755c57b3682fcb084324a93c4cc304dadb5d8ae2b02",
        effectiveGasPrice: "0x989680",
        gasUsed: "0x9c45c",
        timestamp: 1724708769,
        status: "0x1",
        logs: [
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xab8530f87dc9b59234c4623bf917212bb2536d647574c8e7e5da92c2ede0c9f8",
              "0x000000000000000000000000e7ed1fa7f45d05c508232aa32649d89b73b8ba48",
              "0x00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c47",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005efc77f",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c47",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005efc77f",
          },
          {
            address: "0x19330d10d9cc8751218eaf51e8885d058642e08a",
            topics: [
              "0x1b2a7ff080b8cb6ff436ce0372e399692bbfb6d4ae5766fd8d58a7b8cc6142e6",
              "0x00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c47",
              "0x000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005efc77f",
          },
          {
            address: "0xc30362313fbba5cf9163f0bb16a0e01f01a896ca",
            topics: [
              "0x58200b4c34ae05ee816d710053fff3fb75af4395915d3d2a771b24aa10e3cc5d",
              "0x00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c47",
              "0x0000000000000000000000000000000000000000000000000000000000010907",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000000000005a65fc943419a5ad590042fd67c9791fd015acf53a54cc823edb8ff81b9ed722e0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008400000000c6fa7af3bedbad3a3d65f36aabc97431b1bbe4c2d2f6e0e47ca60203452f5d6100000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c470000000000000000000000000000000000000000000000000000000005efc77f74e70ed52464f997369bbefd141d8a2d9dd3cd15e1f21b37bce18f45e0e923b200000000000000000000000000000000000000000000000000000000",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x00000000000000000000000070287c79ee41c5d1df8259cd68ba0890cd389c47",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005efc77f",
          },
          {
            address: "0x70287c79ee41c5d1df8259cd68ba0890cd389c47",
            topics: [
              "0x67cc74e969bff447b6e0f32eea34930545a732749bdcaaf3530c70e311900b06",
              "0x0000000000000000000000000000000000000000000000000000000000000001",
              "0x74e70ed52464f997369bbefd141d8a2d9dd3cd15e1f21b37bce18f45e0e923b2",
              "0x0000000000000000000000000000000000000000000000000000000000000005",
            ],
            data: "0x",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
              "0x000000000000000000000000933e3922e04d47a466e60a20e486b372b64f1ea8",
            ],
            data: "0x00000000000000000000000000000000000000000000000000000000000637cc",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000be3ad6a5669dc0b8b12febc03608860c31e2eef6",
              "0x0000000000000000000000005e325eda8064b456f4781070c0738d849c824258",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005e8ea28",
          },
          {
            address: "0xaf88d065e77c8cc2239327c5edb3a432268e5831",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
              "0x000000000000000000000000be3ad6a5669dc0b8b12febc03608860c31e2eef6",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005e98fb3",
          },
          {
            address: "0xbe3ad6a5669dc0b8b12febc03608860c31e2eef6",
            topics: [
              "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
              "0x0000000000000000000000005e325eda8064b456f4781070c0738d849c824258",
              "0x0000000000000000000000005e325eda8064b456f4781070c0738d849c824258",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005e98fb3fffffffffffffffffffffffffffffffffffffffffffffffffffffffffa1715d80000000000000000000000000000000000000000fff5467f89c1494138064e9200000000000000000000000000000000000000000000000000ab8b2f7306c46afffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc",
          },
          {
            address: "0x82af49447d8a07e3bd95bd0d56f35241523fbab1",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000641c00a822e8b671738d32a431a4fb6074e5c79d",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
            ],
            data: "0x00000000000000000000000000000000000000000000000000835af8c0e18718",
          },
          {
            address: "0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000005e325eda8064b456f4781070c0738d849c824258",
              "0x000000000000000000000000641c00a822e8b671738d32a431a4fb6074e5c79d",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000005e8ea28",
          },
          {
            address: "0x641c00a822e8b671738d32a431a4fb6074e5c79d",
            topics: [
              "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
              "0x0000000000000000000000005e325eda8064b456f4781070c0738d849c824258",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
            ],
            data: "0xffffffffffffffffffffffffffffffffffffffffffffffffff7ca5073f1e78e80000000000000000000000000000000000000000000000000000000005e8ea280000000000000000000000000000000000000000000364972484c160901ef21100000000000000000000000000000000000000000000000010dfb9e8bedc5904fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcfcf8",
          },
          {
            address: "0x82af49447d8a07e3bd95bd0d56f35241523fbab1",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000004de319b7492e791cde47fdf12c922cf568441c43",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
            ],
            data: "0x00000000000000000000000000000000000000000000000000835af8c0e18718",
          },
          {
            address: "0x4de319b7492e791cde47fdf12c922cf568441c43",
            topics: [
              "0x5cdf07ad0fc222442720b108e3ed4c4640f0fadc2ab2253e66f259a0fea83480",
              "0x000000000000000000000000933e3922e04d47a466e60a20e486b372b64f1ea8",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e0374af35071800000000000000000000000000000000000000000000000000000000000637cc",
          },
        ],
        environment: "mainnet",
        chain: "arbitrum",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(23);
    expect(result?.txHash).toBe("64186f62f05347fc1d54618b10f2fbe1c2c7ddee3fcf37de8ff9dcf81914ec08"); // Remove 0x
    expect(result?.blockHeight).toBe(247037681n);
    expect(result?.attributes.blockNumber).toBe(247037681n);
    expect(result?.attributes.from).toBe("0x832232edc32349e240b488f2be0ce80e6c0befa8");
    expect(result?.attributes.to).toBe("0x4de319b7492e791cde47fdf12c922cf568441c43");
    expect(result?.attributes.methodsByAddress).toBe("FillRedeemed");
    expect(result?.attributes.emitterChain).toBe(1);
    expect(result?.attributes.emitterAddress).toBe(
      "74E70ED52464F997369BBEFD141D8A2D9DD3CD15E1F21B37BCE18F45E0E923B2"
    );
    expect(result?.attributes.sequence).toBe(5);
  });

  it("should be able to map log to evmRedeemedTransactionFoundMapper from the abi (e.g MCTP)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x0b46d239cfb3fd3bcc10e3cef299f63b82e93fd0d4aaeeb453eb2e10bb86246d",
        blockNumber: 0x12ed181n,
        chainId: 30,
        from: "0x5acf4e865604ab620fb84acc047b990f2d2856fd",
        gas: "0x57e3d",
        gasPrice: "0x5b5b78",
        hash: "0x4cdf4b54e17b9d32d8f950198de088df51322dee797759476b67ca0fc2588159",
        input:
          "0x958c093700000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000f8000000000000000300000006000000000004a2df00000000000000000000000019330d10d9cc8751218eaf51e8885d058642e08a0000000000000000000000001682ae6375c4e4a97e4b583bc394c861a46d8962000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c00000000000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000006c6eca00000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000000000000000000000000000823047008da48b49eef177a4d90d84fcfe290a1443711b068e96cf96246316d8da37eac0ffa29f1b590a2eaca1a8486d3d95279bc7def1a1e5b250be34bcd05b0b1c572dca0346e1e63e472375f36a94dc6c9f3191531f54604e9560e31e5b891a691b4e13dc014c3b0dc90886622ae1ce66886ccee19e66c614fc7c405d7f5817a41c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003d101000000040d00aeec5211c144e8641d811124f53cd3b5ac8b5f97f3209aebc50ed69e0857efbd0768ba1eb0e71ef7c8ffdab2483303d051d6fa379a075785293ffa338efabab50001305b5b97d48b6887eae2655c823526a1dbc12b60da52cab0c42674b5db42649f599daaa2e7dd5e6045cb7899482ca81a62c267501c5c212198249e9951a906ce00027265a9b286d7b929594711575dccc4864a9ec321270e72d4c268e00fbe71eeff2736b43ac98e6112da86540d6b1d1c7030c04d638bfba304ccdccffac9fb98750003f3506a8792008d3ec58369e1be70c84d35171bf56017edecbb535667ddd05fe034ed5ac0efe99e1f3d4f15637a66124ec988aa2e893d7218e9299258ef2482db0104bb32f56478abc60842b92290e43b6954f069bd0b0418ebf0ae16f3b915dc4451273b5f58ca0fd3197889dc293bac5d101890249b50e9bd2290cbaf71755758bc0005cfaf3ac61801eea99222e5904b7f0fc33d5bc3823fb6ccba28087a8ba324cce77b6c60844c0d14e79c5bc765b33337d475301e0a199a46db523ac2194602cadb01079091a50a73e83aaaa1fe55fe916fda811f0eb67e93dd11f6a857d336eb60269c14353b48df7a365880d6b2d9815a950fede11555f7a395fcbb3c8decaf0742c0000a4bd5d41558b466c0ea6be70829f160a835269450b9d9e378b30bb5170315d4f705e5ceb1f5e732b8b2558dd4a73de6c430d19d010b342e2abf68bee1176103b5010ccc8dd59767f3f2b61d055c8da83c9426d5dadace35e8484cf1db8526976870717c7bafc5d639b937be40600d22d4b665ecd476c08d2104f6ef8531ce783d73f5010d0ba32e09c98e7c6a2a767f23003bb87ade5557d01a59a40fb7addba6c5fc891464e8f6a357acfde31206d7feb57202f310ee2b15235ad891c571d8f8e1928e95010e78019bf751088edb7fc5d9c523ae44589593d663f7f891d5fc730e2f2144600c24ca3f99a360dfe0e623578707a48d29d7ca4b48fc8008f53db058222c983e22010f162e5bcaa1eb1326a5b579d5b97aaff999297a6bf1e12f8c7f4c76c59361191e6ef165c002f75858dd00ac0330f3695017df67dbb656253fac885d7fec02cb0401101d1c4b23abfe2778ba129e19ecc7040055afeebe7f98253915105a496d9e0fe4159d82d2e013bd7546bf4a268590860b6d757b820c97b6ca1e6eff96ed9ddd310066e7fae8000000000017000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c0000000000003cf3010301000000000004a2df00000003000000000000000000000000dcd82cb3787d2e40ea52748da3c61baf1d0a9c3300000000000000000000000000001543000000000000000000000000000000",
        maxFeePerGas: "0x5b5b78",
        maxPriorityFeePerGas: "0x5b5b78",
        nonce: "0x3df0",
        r: "0xd01c77160b32400876b4c1a3a98edc66613e67510d9a1f5bfeec4ff9f4d28f0b",
        s: "0x6dceb83678bae0ac8f4b578ede39e2f770f317d53d1509dc0cbaa688328e87c2",
        to: "0xf18f923480dc144326e6c65d4f3d47aa459bb41c",
        transactionIndex: "0x49",
        type: "0x2",
        v: "0x1",
        value: "0x0",
        effectiveGasPrice: "0x5b5b78",
        gasUsed: "0x55676",
        timestamp: 1726480357,
        status: "0x1",
        logs: [
          {
            address: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
            data: "0x000000000000000000000000000000000000000000000000000000006c6eca00",
            topics: [
              "0xab8530f87dc9b59234c4623bf917212bb2536d647574c8e7e5da92c2ede0c9f8",
              "0x000000000000000000000000e45b133ddc64be80252b0e9c75a8e74ef280eed6",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
            ],
          },
          {
            address: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
            data: "0x000000000000000000000000000000000000000000000000000000006c6eca00",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000000000000000000000000000000000000000000000",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
            ],
          },
          {
            address: "0x1682ae6375c4e4a97e4b583bc394c861a46d8962",
            data: "0x000000000000000000000000000000000000000000000000000000006c6eca00",
            topics: [
              "0x1b2a7ff080b8cb6ff436ce0372e399692bbfb6d4ae5766fd8d58a7b8cc6142e6",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913",
            ],
          },
          {
            address: "0xad09780d193884d503182ad4588450c416d6f9d4",
            data: "0x000000000000000000000000000000000000000000000000000000000000000300000000000000000000000019330d10d9cc8751218eaf51e8885d058642e08a0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008400000000000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c000000000000000000000000000000000000000000000000000000006c6eca00000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c00000000000000000000000000000000000000000000000000000000",
            topics: [
              "0x58200b4c34ae05ee816d710053fff3fb75af4395915d3d2a771b24aa10e3cc5d",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x000000000000000000000000000000000000000000000000000000000004a2df",
            ],
          },
          {
            address: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
            data: "0x0000000000000000000000000000000000000000000000000000000000001543",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x0000000000000000000000005acf4e865604ab620fb84acc047b990f2d2856fd",
            ],
          },
          {
            address: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
            data: "0x000000000000000000000000000000000000000000000000000000006c6eb4bd",
            topics: [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c",
              "0x000000000000000000000000dcd82cb3787d2e40ea52748da3c61baf1d0a9c33",
            ],
          },
        ],
        environment: "mainnet",
        chain: "base",
      },
    ]);

    // Then
    expect(result?.name).toBe("transfer-redeemed");
    expect(result?.chainId).toBe(30);
    expect(result?.txHash).toBe("4cdf4b54e17b9d32d8f950198de088df51322dee797759476b67ca0fc2588159"); // Remove 0x
    expect(result?.blockHeight).toBe(19845505n);
    expect(result?.attributes.blockNumber).toBe(19845505n);
    expect(result?.attributes.from).toBe("0x5acf4e865604ab620fb84acc047b990f2d2856fd");
    expect(result?.attributes.to).toBe("0xf18f923480dc144326e6c65d4f3d47aa459bb41c");
    expect(result?.attributes.methodsByAddress).toBe("MethodRedeemWithFee");
    expect(result?.attributes.emitterChain).toBe(23);
    expect(result?.attributes.emitterAddress).toBe(
      "000000000000000000000000f18f923480dc144326e6c65d4f3d47aa459bb41c"
    );
    expect(result?.attributes.sequence).toBe(15603);
  });

  it("should be able to skip log to evmRedeemedTransactionFoundMapper with redelivery information (e.g STANDARD RELAYER REDELIVERY)", async () => {
    // When
    const [result] = await handler.handle([
      {
        blockHash: "0x24a6c08a8cbc26e969ddf1556ebcb558577315401fc233d8102a546b21787088",
        blockNumber: 0x217dd7fn,
        from: "0x1e15f0c53935137796fb25b040343439d6d0f436",
        gas: "0xcf850",
        gasPrice: "0x62b85e900",
        maxFeePerGas: "0xbfda3a300",
        maxPriorityFeePerGas: "0x59682f00",
        hash: "0x494544f8c01b3cda890306465879fd8e22b4109e4e95de8d15deb6c45fb77e8a",
        input:
          "0xa60eb4c8000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000001e15f0c53935137796fb25b040343439d6d0f4360000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ae01000000000100b06864d09612ea94aa91a18b310056d91855c1999a421079b19e4becbb23b2c412a7dcbc210562e18a3eed3ee2024335226a4510d0a7137f5dca2dcaf2cf0e7d0066a90ac40000000027120000000000000000000000007b1bd7a6b4e61c2a123ac6bc2cbfc614437d0470000000000000648ec80100060000000000000000000000008f27355662d6de024fee83b176dd8db1f2ca1585000000e50001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016eecb8ceb2ce4ec542634d7525191dfce587c85000000000000000000000000ae4c62510f4d930a5c8796dbfb8c4bc7b9b6214000116b62515a7648fc480b4b4c3543f68573506917c5060ae74240cf97d70165cbe700000000000000000000000016870a6a85cd152229b97d018194d66740f932d69e346f42000e34022204148133946577d24f66ffbc6c0e201cec85767ba002f580000000000000000000000000000000000000000000000000016345785d8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000124f80000000000000000000000000000000000000000000000000000000bc09d8b0c000600000000000000000000000016870a6a85cd152229b97d018194d66740f932d600000000000000000000000060a86b97a7596ebfd25fb769053894ed0d9a83660000000000000000000000007a0a53847776f7e94cc35742971acb2217b0db81000000000000000000000000c0cffa934598e655dc8d25cd1774f249ffcf5e590000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a501000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000557300000000000000000000000000000000000000000000000000000000bc09d8b0cab85d139a35e09ecb8516f7f82e0f35d56597b9e1f70efd0d9b737c0ede6fa83000000000000000000000000000000000000000000000000000000",
        nonce: "0x811",
        to: "0xa3cf45939bd6260bcfe3d66bc73d60f19e49a8bb",
        transactionIndex: "0x0",
        value: "0x3ec3bd5f072640",
        type: "0x2",
        chainId: 6,
        v: "0x0",
        r: "0xd2519465f27d9a4ca2ff68c2cea51c6a273a85128e23b39620486a63d5ef4023",
        s: "0x66f0729d15e2a75edf71699902e0d21240d1e7656cb5297dbe80b58f33e5aa7d",
        effectiveGasPrice: "0x62b85e900",
        gasUsed: "0x70fbc",
        timestamp: 1722355737,
        status: "0x1",
        logs: [
          {
            address: "0x1968237f3a7d256d08bcab212d7ae28feda72c34",
            topics: ["0x182609dc2587bbc5673ad1243ef5656ef383ced0d15786b993cda2b67fbdbbe8"],
            data: "0x0000000000000000000000000000000000000000000000000df255e39082d7c50000000000000000000000000000000000000000000000000dec3438cd448b0c0000000000000000000000000000000000000000000000000000000066a91019",
          },
          {
            address: "0x1968237f3a7d256d08bcab212d7ae28feda72c34",
            topics: ["0x9f3d2b2e2a767165238ebfd60447e6b7ea1648cf6410c0df533954838f334bab"],
            data: "0x00000000000000000000000000000000000000000000000000c08bd47a4966dc000000000000000000000000000000000000000000000000012cd6e5f0f6dc570000000000000000000000000000000000000000000000000070763b340bef5a",
          },
          {
            address: "0x2caa1315bd676fbecabfc3195000c642f503f1c9",
            topics: ["0x23e0d4112cc89322a3424d9727323adb034c6b2803a39898a46889514927225c"],
            data: "0x9e346f42000e34022204148133946577d24f66ffbc6c0e201cec85767ba002f50000000000000000000000000000000000000000000000000000000000000080",
          },
          {
            address: "0xa9491a1f4f058832e5742b76ee3f1f1fd7bb6837",
            topics: [
              "0xad1988539b0ec6c00337659800dd74b159ca84862a6639b7d577cc354fa0e7b2",
              "0x2efa2a6e8762a5cef3dbdf964d49fd04fb71b5ae61d07d40a7aa91d2cad355dd",
            ],
            data: "0x0000000000000000000000000000000000000000000000000000000000000002",
          },
          {
            address: "0x8f27355662d6de024fee83b176dd8db1f2ca1585",
            topics: [
              "0xef755efc39fc0fd58b606933986b425bf5fdd819668b05ecd388afaee9d00a89",
              "0x2efa2a6e8762a5cef3dbdf964d49fd04fb71b5ae61d07d40a7aa91d2cad355dd",
            ],
            data: "0x000000000000000000000000c0cffa934598e655dc8d25cd1774f249ffcf5e59",
          },
          {
            address: "0xa3cf45939bd6260bcfe3d66bc73d60f19e49a8bb",
            topics: [
              "0xbccc00b713f54173962e7de6098f643d8ebf53d488d71f4b2a5171496d038f9e",
              "0x0000000000000000000000008f27355662d6de024fee83b176dd8db1f2ca1585",
              "0x0000000000000000000000000000000000000000000000000000000000002712",
              "0x000000000000000000000000000000000000000000000000000000000000648e",
            ],
            data: "0x2efa2a6e8762a5cef3dbdf964d49fd04fb71b5ae61d07d40a7aa91d2cad355dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003eaaf000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a501000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000557300000000000000000000000000000000000000000000000000000000bc09d8b0cab85d139a35e09ecb8516f7f82e0f35d56597b9e1f70efd0d9b737c0ede6fa83000000000000000000000000000000000000000000000000000000",
          },
        ],
        environment: "testnet",
        chain: "avalanche",
      },
    ]);

    // Then
    expect(result).toBeUndefined;
  });
});
